---
import BaseLayout from "../layouts/BaseLayout.astro"
import Header from "../components/layout/Header.astro"
import Footer from "../components/layout/Footer.astro"
import CodeBlock from "../components/CodeBlock.astro"
import AnimatedSection from "../components/AnimatedSection.astro"
import CheckList from "../components/CheckList.astro"
import ScrollIndicator from "../components/ScrollIndicator.astro"
import SectionHeader from "../components/SectionHeader.astro"
import OSCard from "../components/OSCard.astro"
import SplitSection from "../components/SplitSection.astro"
import SkepticQuote from "../components/SkepticQuote.astro"
import CTAButtons from "../components/CTAButtons.astro"
import HighlightBox from "../components/HighlightBox.astro"

const recipeAdvantages = [
	"Pin exact versions — your system stays reproducible",
	"Read the build logic in seconds — it's just Rhai script",
	"Add patches directly — your recipes, your rules",
	"Full audit trail of what's installed and how",
]

const assistantFeatures = [
	"Drafts .rhai recipes from upstream documentation",
	"Reads build logs and suggests fixes",
	"Runs entirely local — your machine, your data",
	"You review and execute — AI handles the boilerplate",
]

const recipeCode = `// recipes/ripgrep.rhai
let ctx = #{
    name: "ripgrep",
    version: "14.1.0",
    repo: "BurntSushi/ripgrep",
};

fn is_acquired(ctx) {
    is_file(join_path(BUILD_DIR, "rg/Cargo.toml"))
}

fn acquire(ctx) {
    let tarball = github_download_release(
        ctx.repo, ctx.version, "*.tar.gz"
    );
    extract(tarball, BUILD_DIR);
}

fn build(ctx) {
    shell_in(BUILD_DIR + "/rg",
        "cargo build --release");
}

fn install(ctx) {
    let bin = BUILD_DIR + "/rg/target/release/rg";
    shell("install -Dm755 " + bin + " $OUT/usr/bin/rg");
}`

const assistantCode = `$ recipe llm "create a recipe for htop"

Drafting recipe for htop...

// recipes/htop.rhai
let ctx = #{
    name: "htop",
    version: "3.3.0",
    repo: "htop-dev/htop",
};

fn is_acquired(ctx) {
    is_file(join_path(BUILD_DIR, "htop/configure.ac"))
}

fn acquire(ctx) {
    let tarball = github_download_release(
        ctx.repo, ctx.version, "*.tar.xz"
    );
    extract(tarball, BUILD_DIR);
}

fn build(ctx) {
    let src = BUILD_DIR + "/htop";
    shell_in(src, "./autogen.sh && ./configure && make");
}

fn install(ctx) {
    shell_in(BUILD_DIR + "/htop", "make install DESTDIR=$OUT");
}

Recipe saved. Review and run: recipe install htop`

const docsFeatures = [
	"<strong class=\"text-foreground\">Code</strong> on the left",
	"<strong class=\"text-foreground\">Documentation</strong> on the right",
	"<strong class=\"text-foreground\">Context</strong> exactly when you need it",
]
---

<BaseLayout
	title="LevitateOS - A Linux Distribution You Actually Control"
	description="Linux where you maintain your own packages. Write simple Rhai recipes, build from source, with local AI assistance. Full control, no upstream dependencies."
>
	<div class="flex min-h-screen flex-col">
		<Header />
		<main class="flex-1">
			<!-- Hero -->
			<section
				id="hero"
				class="relative min-h-[85vh] flex flex-col items-center justify-center text-center py-12 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-primary/5 via-transparent to-transparent"
			>
				<div class="container flex flex-col items-center max-w-3xl">
					<AnimatedSection>
						<img
							id="hero-logo"
							src="/levitateos-light.png"
							alt="LevitateOS"
							width="192"
							height="192"
							class="w-36 sm:w-40 lg:w-48 h-auto mb-6"
						/>
					</AnimatedSection>

					<AnimatedSection delay={50}>
						<p class="text-sm font-medium text-primary uppercase tracking-widest mb-3">
							The first vibe-coded Linux Distribution
						</p>
					</AnimatedSection>

					<AnimatedSection delay={150}>
						<h1 class="text-3xl sm:text-4xl lg:text-5xl font-medium tracking-tight">
							Customization from the <span class="text-primary">package level</span>.
						</h1>
					</AnimatedSection>

					<AnimatedSection delay={250} class="mt-5 max-w-2xl">
						<p class="text-sm text-muted-foreground leading-relaxed">
						Make your own package repository. While other Linux distributions rely on centralized repositories, here we take the slow route. You write your own packages named "recipes": declaring how to acquire, build and install each piece of software.
						</p>
					</AnimatedSection>

					<AnimatedSection delay={350} class="mt-3 max-w-2xl">
						<p class="text-sm text-muted-foreground leading-relaxed">
							Too slow? No worries. This is designed with a locally running LLM (SmolLM3) that generates, customizes and maintains your recipes and handles dependencies.
						</p>
					</AnimatedSection>

					<AnimatedSection delay={450} class="mt-6">
						<p class="text-lg font-medium">
							Manual install. Full control. <span class="text-primary">AI-assisted packaging</span>.
						</p>
					</AnimatedSection>

					<AnimatedSection delay={550} class="mt-6">
						<CTAButtons
							primaryHref="#recipe"
							primaryText="See How It Works"
							secondaryHref="https://github.com/LevitateOS/LevitateOS"
							secondaryText="GitHub"
							centered={true}
						/>
					</AnimatedSection>
				</div>

				<ScrollIndicator />
			</section>

			<!-- Two Flavors -->
			<section id="flavors" class="py-16 bg-muted/30">
				<div class="container max-w-4xl">
					<div class="text-center mb-8">
						<h2 class="text-2xl sm:text-3xl font-medium mb-3">Two Foundations. One Philosophy.</h2>
						<p class="text-muted-foreground text-sm max-w-2xl mx-auto">
							Choose your base. Both share the same recipe system and tools.
						</p>
					</div>

					<div class="grid md:grid-cols-2 gap-6">
						<OSCard
							name="LevitateOS"
							stack="glibc / systemd / GNU"
							description="Maximum software compatibility. If it runs on Linux, it runs here. Systemd handles services, timers, and boot."
							features={["Broadest package compatibility", "Comprehensive service management", "Rocky 10 RPMs for dependencies", "Familiar to most Linux users"]}
							logoLight="/levitateos-light.png"
							logoDark="/levitateos-dark.png"
						/>

						<OSCard
							name="AcornOS"
							stack="musl / OpenRC / busybox"
							description="Smaller binaries, faster boot, simpler init. For those who prefer knowing exactly what's running on their system."
							features={["Leaner compiled binaries", "Straightforward init scripts", "Alpine Linux PKGs for dependencies", "Less complexity under the hood"]}
							logoLight="/acornos-light.png"
							logoDark="/acornos-dark.png"
						/>
					</div>
				</div>
			</section>

			<!-- Recipe System -->
			<section id="recipe" class="py-16">
				<div class="container max-w-4xl">
					<SplitSection>
						<SectionHeader
							title="Recipes, Not Repositories"
						/>
						<p class="text-muted-foreground text-sm mb-3">
							Instead of <code class="bg-muted px-1.5 py-0.5">apt</code> or <code class="bg-muted px-1.5 py-0.5">dnf</code>, LevitateOS uses <code class="bg-muted px-1.5 py-0.5">recipe</code>.
						</p>
						<p class="text-muted-foreground text-sm mb-4">
							A recipe is an elaborate <code class="bg-muted px-1.5 py-0.5">.rhai</code> script that describes how to acquire, build, and install a package. Rhai is a safe, sandboxed scripting language embedded in Rust — readable in seconds, impossible to hide malicious code in.
						</p>
						<CheckList items={recipeAdvantages} />
						<Fragment slot="demo">
							<CodeBlock code={recipeCode} language="rust" />
							<p class="text-sm text-muted-foreground mt-3 text-center">
								Everything a package does, in one readable file.
							</p>
						</Fragment>
					</SplitSection>
				</div>
			</section>

			<!-- Local Assistant -->
			<section id="assistant" class="py-16 bg-muted/30">
				<div class="container max-w-4xl">
					<SplitSection reverse={true}>
						<Fragment slot="demo">
							<CodeBlock code={assistantCode} language="bash" />
						</Fragment>
						<SectionHeader
							title="Local Recipe Assistant"
						/>
						<p class="text-muted-foreground text-sm mb-3">
							Writing recipes is straightforward, but you shouldn't have to do it from scratch.
						</p>
						<p class="text-muted-foreground text-sm mb-4">
							The recipe assistant is a local LLM that drafts recipes by reading upstream documentation. It runs on your machine — no cloud, no telemetry. You review the output, make adjustments, and run it.
						</p>
						<CheckList items={assistantFeatures} />
					</SplitSection>
				</div>
			</section>

			<!-- Documentation -->
			<section id="docs" class="py-16">
				<div class="container max-w-3xl text-center">
					<SectionHeader
						title="Embedded Documentation"
						centered={true}
					/>
					<p class="text-muted-foreground text-sm max-w-2xl mx-auto mb-6">
						LevitateOS installs manually. The documentation lives alongside your terminal in a tmux pane — no browser tabs, no context switching.
					</p>
					<HighlightBox class="text-left">
						<p class="text-foreground text-sm mb-3">
							The install guide appears <strong>right next to your shell</strong>:
						</p>
						<ul class="space-y-2 text-muted-foreground text-sm">
							{docsFeatures.map((feature) => (
								<li class="flex items-start gap-2">
									<svg class="size-4 text-primary shrink-0 mt-0.5" viewBox="0 0 256 256" fill="currentColor">
										<path d="M229.66 77.66l-128 128a8 8 0 0 1-11.32 0l-56-56a8 8 0 0 1 11.32-11.32L96 188.69l122.34-122.35a8 8 0 0 1 11.32 11.32Z" />
									</svg>
									<span set:html={feature} />
								</li>
							))}
						</ul>
					</HighlightBox>
				</div>
			</section>

			<!-- Get Started -->
			<section id="verdict" class="py-16 bg-muted/30">
				<div class="container max-w-3xl text-center">
					<h2 class="text-2xl sm:text-3xl font-medium mb-4">Ready to Build?</h2>
					<p class="text-sm text-muted-foreground mb-3">
						LevitateOS is for engineers who want to understand their system — and have the tools to shape it.
					</p>
					<p class="text-lg text-foreground font-medium mb-6">
						A clean base. Readable recipes. Local AI assistance.<br/>
						<span class="text-primary">Your system, your way.</span>
					</p>
					<CTAButtons
						primaryHref="/download"
						primaryText="Download"
						secondaryHref="https://github.com/LevitateOS/LevitateOS"
						secondaryText="View on GitHub"
						centered={true}
					/>
				</div>
			</section>

			<!-- Standing on Giants -->
			<section id="thanks" class="py-12">
				<div class="container max-w-4xl">
					<div class="text-center mb-6">
						<h2 class="text-xl font-medium">Standing on the Shoulders of Giants</h2>
					</div>
					<div class="grid gap-4 sm:grid-cols-3 text-left">
						<div class="p-4 ring-1 ring-foreground/10">
							<a href="https://archlinux.org" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-primary hover:underline">Arch Linux</a>
							<p class="text-sm text-muted-foreground mt-1">For the blueprint on user-controlled distributions and manual installation.</p>
						</div>
						<div class="p-4 ring-1 ring-foreground/10">
							<a href="https://rockylinux.org" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-primary hover:underline">Rocky Linux</a>
							<p class="text-sm text-muted-foreground mt-1">For stable, battle-tested RPM packages that we extract and repackage.</p>
						</div>
						<div class="p-4 ring-1 ring-foreground/10">
							<a href="https://alpinelinux.org" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-primary hover:underline">Alpine Linux</a>
							<p class="text-sm text-muted-foreground mt-1">For proving that musl and simplicity can power production systems.</p>
						</div>
						<div class="p-4 ring-1 ring-foreground/10">
							<a href="https://nixos.org" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-primary hover:underline">Nix</a>
							<p class="text-sm text-muted-foreground mt-1">For pioneering dependency management and reproducible builds.</p>
						</div>
						<div class="p-4 ring-1 ring-foreground/10">
							<a href="https://gentoo.org" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-primary hover:underline">Gentoo</a>
							<p class="text-sm text-muted-foreground mt-1">For USE flags and the philosophy of compile-time customization.</p>
						</div>
						<div class="p-4 ring-1 ring-foreground/10">
							<a href="https://universal-blue.org" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-primary hover:underline">Universal Blue</a>
							<p class="text-sm text-muted-foreground mt-1">For demonstrating image-based atomicity on the desktop.</p>
						</div>
						<div class="p-4 ring-1 ring-foreground/10">
							<a href="https://claude.ai/claude-code" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-primary hover:underline">Claude Code</a>
							<p class="text-sm text-muted-foreground mt-1">For AI-assisted development that accelerated this project.</p>
						</div>
						<div class="p-4 ring-1 ring-foreground/10">
							<a href="https://huggingface.co" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-primary hover:underline">Hugging Face</a>
							<p class="text-sm text-muted-foreground mt-1">For SmolLM3, the local LLM powering the recipe assistant.</p>
						</div>
						<div class="p-4 ring-1 ring-foreground/10">
							<a href="https://rust-lang.org" target="_blank" rel="noopener noreferrer" class="text-sm font-medium text-primary hover:underline">Rust</a>
							<p class="text-sm text-muted-foreground mt-1">For a compiler that catches memory bugs before they happen.</p>
						</div>
					</div>
				</div>
			</section>
		</main>
		<Footer />
	</div>
</BaseLayout>

<script>
	// Update logo based on theme
	function updateLogo() {
		const logo = document.getElementById("hero-logo") as HTMLImageElement
		if (logo) {
			const isDark = document.documentElement.classList.contains("dark")
			logo.src = isDark ? "/levitateos-dark.png" : "/levitateos-light.png"
		}
	}

	// Update on theme toggle
	const observer = new MutationObserver(updateLogo)
	observer.observe(document.documentElement, { attributes: true, attributeFilter: ["class"] })

	// Initial update
	updateLogo()
</script>
