---
// Theme toggle with sun/moon icons
// Uses JavaScript to toggle visibility (not CSS dark: classes) for reliability
---

<button
	id="theme-toggle"
	class="inline-flex items-center justify-center size-8 rounded-md hover:bg-muted transition-colors"
	aria-label="Toggle theme"
>
	<!-- Sun icon (shown in dark mode - click to go light) -->
	<svg id="sun-icon" class="h-5 w-5 hidden" viewBox="0 0 256 256" fill="currentColor">
		<path
			d="M120 40V16a8 8 0 0 1 16 0v24a8 8 0 0 1-16 0Zm72 88a64 64 0 1 1-64-64a64.07 64.07 0 0 1 64 64Zm-16 0a48 48 0 1 0-48 48a48.05 48.05 0 0 0 48-48ZM58.34 69.66a8 8 0 0 0 11.32-11.32l-16-16a8 8 0 0 0-11.32 11.32Zm0 116.68l-16 16a8 8 0 0 0 11.32 11.32l16-16a8 8 0 0 0-11.32-11.32ZM192 72a8 8 0 0 0 5.66-2.34l16-16a8 8 0 0 0-11.32-11.32l-16 16A8 8 0 0 0 192 72Zm5.66 114.34a8 8 0 0 0-11.32 11.32l16 16a8 8 0 0 0 11.32-11.32ZM48 128a8 8 0 0 0-8-8H16a8 8 0 0 0 0 16h24a8 8 0 0 0 8-8Zm80 80a8 8 0 0 0-8 8v24a8 8 0 0 0 16 0v-24a8 8 0 0 0-8-8Zm112-88h-24a8 8 0 0 0 0 16h24a8 8 0 0 0 0-16Z"
		></path>
	</svg>
	<!-- Moon icon (shown in light mode - click to go dark) -->
	<svg id="moon-icon" class="h-5 w-5" viewBox="0 0 256 256" fill="currentColor">
		<path
			d="M233.54 142.23a8 8 0 0 0-8-2a88.08 88.08 0 0 1-109.8-109.8a8 8 0 0 0-10-10a104.84 104.84 0 0 0-52.91 37A104 104 0 0 0 136 224a103.09 103.09 0 0 0 62.52-20.88a104.84 104.84 0 0 0 37-52.91a8 8 0 0 0-1.98-7.98Zm-44.64 48.11A88 88 0 0 1 65.66 65.66a88.11 88.11 0 0 1 25.79-19.9a104 104 0 0 0 118.79 118.79a88.11 88.11 0 0 1-21.34 25.79Z"
		></path>
	</svg>
	<span class="sr-only">Toggle theme</span>
</button>

<script>
	function initTheme() {
		const toggle = document.getElementById("theme-toggle")
		const sunIcon = document.getElementById("sun-icon")
		const moonIcon = document.getElementById("moon-icon")

		function updateIcons() {
			const isDark = document.documentElement.classList.contains("dark")
			// Sun shown in dark mode (click to go light)
			// Moon shown in light mode (click to go dark)
			sunIcon?.classList.toggle("hidden", !isDark)
			moonIcon?.classList.toggle("hidden", isDark)
		}

		// Remove any existing listener to prevent duplicates on page transitions
		const newToggle = toggle?.cloneNode(true)
		if (toggle && newToggle) {
			toggle.parentNode?.replaceChild(newToggle, toggle)

			newToggle.addEventListener("click", () => {
				const isDark = document.documentElement.classList.toggle("dark")
				localStorage.setItem("theme", isDark ? "dark" : "light")
				updateIcons()
			})
		}

		// Set initial icon state based on current theme
		updateIcons()
	}

	// Run on initial page load
	initTheme()

	// Run on Astro page transitions (View Transitions)
	document.addEventListener("astro:page-load", initTheme)
</script>
