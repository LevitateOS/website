---
import type { CommandBlock } from "@levitate/docs-content"
import { Code } from "astro:components"

interface Props {
	block: CommandBlock
}

const { block } = Astro.props
const commandText = Array.isArray(block.command) ? block.command.join("\n") : block.command
---

<div class="mb-4">
	<div class="bg-[var(--muted)] rounded text-sm overflow-hidden">
		<div class="text-muted-foreground px-4 py-2 border-b border-foreground/10">{block.description}</div>
		<div class="relative p-4">
			<div class="absolute top-0 right-0 flex items-center gap-2 px-2 py-1 text-xs text-muted-foreground">
				<span>bash</span>
				<span class="text-muted-foreground/50">|</span>
				<button
					type="button"
					class="copy-btn flex items-center gap-1 hover:text-foreground transition-colors"
					data-code={commandText}
				>
					<svg class="copy-icon w-3 h-3" viewBox="0 0 256 256" fill="currentColor">
						<path
							d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8Zm-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"
						></path>
					</svg>
					<svg class="check-icon hidden w-3 h-3" viewBox="0 0 256 256" fill="currentColor">
						<path
							d="M229.66 77.66l-128 128a8 8 0 0 1-11.32 0l-56-56a8 8 0 0 1 11.32-11.32L96 188.69l122.34-122.35a8 8 0 0 1 11.32 11.32Z"
						></path>
					</svg>
					<span class="copy-text">copy</span>
				</button>
			</div>
			<div class="[&>pre]:p-0 [&>pre]:overflow-x-auto">
				<Code code={commandText} lang="bash" themes={{ light: "github-light", dark: "github-dark" }} />
			</div>
		</div>
		{
			block.output && (
				<div class="bg-background/50 px-4 py-3 border-t border-dashed border-foreground/10">
					<pre class="text-muted-foreground/60 text-xs overflow-x-auto">{block.output}</pre>
				</div>
			)
		}
	</div>
</div>

<script>
	document.querySelectorAll<HTMLButtonElement>(".copy-btn").forEach((btn) => {
		btn.addEventListener("click", async () => {
			const code = btn.dataset.code
			if (code) {
				await navigator.clipboard.writeText(code)
				const copyIcon = btn.querySelector(".copy-icon")
				const checkIcon = btn.querySelector(".check-icon")
				const copyText = btn.querySelector(".copy-text")
				if (copyIcon && checkIcon && copyText) {
					copyIcon.classList.add("hidden")
					checkIcon.classList.remove("hidden")
					copyText.textContent = "copied"
					setTimeout(() => {
						copyIcon.classList.remove("hidden")
						checkIcon.classList.add("hidden")
						copyText.textContent = "copy"
					}, 2000)
				}
			}
		})
	})
</script>
