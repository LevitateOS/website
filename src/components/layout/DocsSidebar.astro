---
import { docsNav, contentBySlug } from "@levitate/docs-content"

interface Props {
	currentSlug: string
}

const { currentSlug } = Astro.props
const currentPath = `/docs/${currentSlug}`

function toAnchor(title: string): string {
	return title
		.toLowerCase()
		.replace(/[^a-z0-9\s-]/g, "")
		.replace(/\s+/g, "-")
}
---

<aside class="hidden md:block w-48 shrink-0 sticky top-20 h-[calc(100vh-6rem)]">
	<div class="h-full overflow-y-auto">
		<nav class="space-y-4 pr-4">
			{
				docsNav.map((section) => (
					<div>
						<h3 class="font-semibold mb-2">{section.title}</h3>
						<ul class="space-y-1">
							{section.items.map((item) => {
								const isActive = currentPath === item.href
								const slug = item.href.replace("/docs/", "")
								const content = contentBySlug[slug]
								const sections = content?.sections || []

								return (
									<li>
										<a
											href={item.href}
											class={`block px-3 py-1.5 text-sm transition-colors ${
												isActive
													? "bg-primary text-primary-foreground"
													: "text-muted-foreground hover:bg-muted hover:text-foreground"
											}`}
										>
											{item.title}
										</a>
										{isActive && sections.length > 0 && (
											<ul class="mt-1 ml-3 border-l border-border space-y-0.5">
												{sections.map((s) => (
													<li>
														<a
															href={`#${toAnchor(s.title)}`}
															class={`block px-3 py-1 text-xs transition-colors text-muted-foreground hover:text-foreground ${
																(s.level ?? 2) === 3 ? "pl-6" : ""
															}`}
														>
															{s.title}
														</a>
													</li>
												))}
											</ul>
										)}
									</li>
								)
							})}
						</ul>
					</div>
				))
			}
		</nav>
	</div>
</aside>
